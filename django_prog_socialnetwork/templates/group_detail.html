{% extends 'base.html' %}
{% block content %}
<h2>{{ group.name }}</h2>

{% if is_member %}
<form method="post" action="{% url 'leave_group' group.id %}">
    {% csrf_token %}
    <button type="submit">Lascia gruppo</button>
</form>
{% else %}
<form method="post" action="{% url 'join_group' group.id %}">
    {% csrf_token %}
    <button type="submit">Unisciti al gruppo</button>
</form>
{% endif %}

<h3>Post</h3>
<ul>
    {% for post in posts %}
    <li>
        <strong>{{ post.author.username }}</strong>: {{ post.content }}
        {% if user == post.author or is_moderator %}
        <form method="post" action="{% url 'delete_post' group.id post.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Elimina</button>
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>

{% if is_member %}
<form method="post" action="{% url 'create_post' group.id %}">
    {% csrf_token %}
    <textarea name="content" placeholder="Scrivi un post"></textarea>
    <button type="submit">Pubblica</button>
</form>
{% endif %}

{% if is_moderator %}
<h4>Membri</h4>
<ul>
    {% for membership in group.groupmembership_set.all %}
    <li>
        {{ membership.user.username }}
        {% if membership.user != user %}
        <form method="post" action="{% url 'remove_user' group.id membership.user.id %}">
            {% csrf_token %}
            <button type="submit">Rimuovi</button>
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endif %}

{% endblock %}